<div class="compte-container">
  <h2>Gestion des Comptes</h2>

  <!-- Barre de recherche combinée -->
  <div class="search-section">
    <label for="searchQuery">Rechercher par numéro de compte ou CNE du client :</label>
    <input
      type="text"
      id="searchQuery"
      [(ngModel)]="searchQuery"
      placeholder="Entrer le numéro de compte ou CNE du client"
    />
    <button (click)="search()">Rechercher</button>
  </div>

  <hr />

  <!-- Formulaire pour ajouter un nouveau compte -->
  <div class="form-section">
    <h3>Ajouter un Nouveau Compte</h3>
    <button (click)="showAddForm = !showAddForm">
      {{ showAddForm ? 'Masquer' : 'Afficher' }} Formulaire d'Ajout
    </button>
    <form *ngIf="showAddForm" (ngSubmit)="createCompte()">
      <div>
        <label for="clientId">Client :</label>
        <select id="clientId" [(ngModel)]="selectedClientId" name="clientId" required>
          <option value="" disabled selected>Sélectionnez un client</option>
          <option *ngFor="let client of clients" [value]="client.idClient">
            {{ client.firstName }} {{ client.lastName }} ({{ client.cne }})
          </option>
        </select>
      </div>
      <div>
        <label for="numeroCompte">Numéro de compte :</label>
        <input type="text" id="numeroCompte" [(ngModel)]="newCompte.numeroCompte" name="numeroCompte" required />
      </div>
      <div>
        <label for="typeCompte">Type de compte :</label>
        <select id="typeCompte" [(ngModel)]="newCompte.typeCompte" name="typeCompte" required>
          <option value="COURANT">Courant</option>
          <option value="EPARGNE">Épargne</option>
        </select>
      </div>
      <div>
        <label for="solde">Solde :</label>
        <input type="number" id="solde" [(ngModel)]="newCompte.solde" name="solde" required />
      </div>
      <div>
        <label for="dateOuverture">Date d'ouverture :</label>
        <input type="date" id="dateOuverture" [(ngModel)]="newCompte.dateOuverture" name="dateOuverture" required />
      </div>
      <div *ngIf="newCompte.typeCompte === 'EPARGNE'">
        <label for="taux">Taux :</label>
        <input type="number" id="taux" [(ngModel)]="newCompte.taux" name="taux" />
      </div>
      <div *ngIf="newCompte.typeCompte === 'COURANT'">
        <label for="decouvert">Découvert :</label>
        <input type="number" id="decouvert" [(ngModel)]="newCompte.decouvert" name="decouvert" />
      </div>
      <button type="submit">Ajouter</button>
    </form>
  </div>

  <hr />

  <!-- Liste des comptes -->
  <div class="comptes-section">
    <h3>Liste des Comptes</h3>
    <table>
      <thead>
      <tr>
        <th>Numéro</th>
        <th>Type</th>
        <th>Solde</th>
        <th>Date d'ouverture</th>
        <th>Taux/Découvert</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let compte of comptes">
        <td>
          <input *ngIf="compte === selectedCompte" [(ngModel)]="compte.numeroCompte" />
          <span *ngIf="compte !== selectedCompte">{{ compte.numeroCompte }}</span>
        </td>
        <td>
          <select *ngIf="compte === selectedCompte" [(ngModel)]="compte.typeCompte">
            <option value="COURANT">Courant</option>
            <option value="EPARGNE">Épargne</option>
          </select>
          <span *ngIf="compte !== selectedCompte">{{ compte.typeCompte }}</span>
        </td>
        <td>
          <input *ngIf="compte === selectedCompte" type="number" [(ngModel)]="compte.solde" />
          <span *ngIf="compte !== selectedCompte">{{ compte.solde }}</span>
        </td>
        <td>
          <input *ngIf="compte === selectedCompte" type="date" [(ngModel)]="compte.dateOuverture" />
          <span *ngIf="compte !== selectedCompte">{{ compte.dateOuverture }}</span>
        </td>
        <td>
            <span *ngIf="compte.typeCompte === 'EPARGNE'">
              <input *ngIf="compte === selectedCompte" type="number" [(ngModel)]="compte.taux" />
              <span *ngIf="compte !== selectedCompte">Taux : {{ compte.taux }}</span>
            </span>
          <span *ngIf="compte.typeCompte === 'COURANT'">
              <input *ngIf="compte === selectedCompte" type="number" [(ngModel)]="compte.decouvert" />
              <span *ngIf="compte !== selectedCompte">Découvert : {{ compte.decouvert }}</span>
            </span>
        </td>
        <td>
          <button *ngIf="compte !== selectedCompte" (click)="selectCompteForUpdate(compte)">Modifier</button>
          <button *ngIf="compte === selectedCompte" (click)="updateCompte(compte)">Enregistrer</button>
          <button *ngIf="compte === selectedCompte" (click)="selectedCompte = null">Annuler</button>
          <button (click)="deleteCompte(compte.idCompte)">Supprimer</button>
          <button (click)="showCartes(compte)">Voir cartes</button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Section pour afficher les cartes bancaires -->
  <div class="cartes-section" *ngIf="selectedCompteCartes">
    <h3>Cartes Bancaires</h3>
    <button (click)="closeCartes()">Fermer</button>
    <table>
      <thead>
      <tr>
        <th>Numéro de carte</th>
        <th>Date d'expiration</th>
        <th>Code PIN</th>
        <th>Limite</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let carte of selectedCompteCartes">
        <td>{{ carte.numeroCarte }}</td>
        <td>{{ carte.dateExpiration }}</td>
        <td>{{ carte.codePin }}</td>
        <td>{{ carte.limiteCarte }}</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
